define("qui/controls/taskbar/Bar",["qui/controls/Control","qui/controls/taskbar/Task","qui/controls/taskbar/Group","qui/controls/buttons/Button","qui/controls/contextmenu/Item","css!qui/controls/taskbar/Bar.css"],function(Control,TaskbarTask,TaskbarGroup,Button,ContextmenuItem){"use strict";return new Class({Extends:Control,Type:"qui/controls/taskbar/Bar",Binds:["$onTaskRefresh","$onTaskDestroy","$onTaskClick"],options:{width:false,styles:false,position:"bottom"},initialize:function(options){this.$Elm=null;this.$TaskButton=null;this.$tasks=[];this.$Active=null;this.parent(options)},serialize:function(){var tasks=[];for(var i=0,len=this.$tasks.length;i<len;i++){tasks.push(this.$tasks[i].serialize())}return{attributes:this.getAttributes(),type:this.getType(),tasks:tasks}},unserialize:function(data){this.setAttributes(data.attributes);if(!this.$Elm){this.$serialize=data;return this}var tasks=data.tasks;if(!tasks){return this}var self=this;var i,len,Task;var importInit=function(Task){self.appendChild(Task)};for(i=0,len=tasks.length;i<len;i++){if(tasks[i].type==="qui/controls/taskbar/Group"){Task=new TaskbarGroup}else{Task=new TaskbarTask}Task.addEvent("onInit",importInit);Task.unserialize(tasks[i])}},create:function(){if(this.$Elm){this.refresh();return this.$Elm}this.$Elm=new Element("div",{"class":"qui-taskbar box","data-quiid":this.getId()});if(this.getAttribute("styles")){this.$Elm.setStyles(this.getAttribute("styles"))}if(this.getAttribute("position")=="bottom"){this.$Elm.addClass("qui-taskbar-bottom")}if(this.getAttribute("position")=="top"){this.$Elm.addClass("qui-taskbar-top")}this.$TaskButton=new Button({name:"qui-taskbar-btn-"+this.getId(),"class":"qui-taskbar-button",icon:"icon-chevron-up",styles:{width:30,height:30}}).inject(this.$Elm);this.$TaskButton.disable();if(typeof this.$serialize!=="undefined"){this.unserialize(this.$serialize)}return this.$Elm},refresh:function(){},appendChild:function(Task){this.fireEvent("appendChildBegin",[this,Task]);var Parent=Task.getParent();if(Parent&&Parent.getType()==="qui/controls/taskbar/Bar"){Task.removeEvent("refresh",Parent.$onTaskRefresh);Task.removeEvent("destroy",Parent.$onTaskDestroy);Task.removeEvent("click",Parent.$onTaskClick)}Task.setParent(this);Task.addEvent("onRefresh",this.$onTaskRefresh);Task.addEvent("onDestroy",this.$onTaskDestroy);Task.addEvent("onClick",this.$onTaskClick);Task.normalize();Task.inject(this.$Elm);this.$tasks.push(Task);this.$TaskButton.appendChild(new ContextmenuItem({icon:Task.getIcon(),text:Task.getTitle(),name:Task.getId(),Task:Task,events:{onMouseDown:function(Item,event){Item.getAttribute("Task").click()}}}));this.$TaskButton.enable();this.fireEvent("appendChild",[this,Task]);return this},firstChild:function(){if(this.$tasks[0]){return this.$tasks[0]}return false},lastChild:function(){if(this.$tasks.length){return this.$tasks[this.$tasks.length-1]}return false},removeChild:function(Task){var Child=false;if(this.$TaskButton){this.$TaskButton.getContextMenu(function(Menu){var Child=Menu.getChildren(Task.getId());if(Child){Child.destroy()}})}Task.removeEvent("refresh",this.$onTaskRefresh)},highlight:function(){this.$Elm.addClass("highlight");return this},normalize:function(){this.$Elm.removeClass("highlight");return this},$onTaskRefresh:function(Task){if(!this.$TaskButton){return}this.$TaskButton.getContextMenu(function(Menu){var Child=Menu.getChildren(Task.getId());if(!Child){return}Child.setAttribute("icon",Task.getIcon());Child.setAttribute("text",Task.getTitle())})},$onTaskDestroy:function(Task){this.removeChild(Task)},$onTaskClick:function(Task,event){if(this.$Active==Task){return}if(this.$Active){this.$Active.normalize()}this.$Active=Task;this.$Active.activate()}})});
//# sourceMappingURL=/var/www/git/quiqqer/qui/build/qui/controls/taskbar/Bar.map.js