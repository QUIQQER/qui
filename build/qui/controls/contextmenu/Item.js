define("qui/controls/contextmenu/Item",["qui/QUI","qui/controls/Control","qui/classes/utils/DragDrop","qui/controls/contextmenu/Menu","qui/controls/contextmenu/Item","qui/controls/contextmenu/Seperator","qui/utils/Controls","css!qui/controls/contextmenu/Item.css"],function(QUI,Control,DragDrop,ContextMenu,ContextMenuItem,ContextMenuSeperator,Utils){"use strict";return new Class({Extends:Control,Type:"qui/controls/contextmenu/Item",Binds:["$onSetAttribute","$stringEvent","$onClick","$onMouseEnter","$onMouseLeave","$onMouseUp","$onMouseDown"],options:{text:"",icon:"",styles:null,dragable:false},initialize:function(options){var items=options.items||[],events=options.events||false;delete options.items;delete options.events;this.parent(options);this.$items=[];this.$Elm=null;this.$Menu=null;this.$path="";this.addEvent("onSetAttribute",this.$onSetAttribute);if(items.length){this.insert(items)}if(!events){return}for(var event in events){if(typeof events[event]==="string"){this.addEvent(event,this.$stringEvent.bind(this,events[event]));continue}this.addEvent(event,events[event])}},create:function(){var i,len;this.$Elm=new Element("div.qui-contextitem",{html:'<div class="qui-contextitem-container">'+'<span class="qui-contextitem-icon"></span>'+'<span class="qui-contextitem-text"></span>'+"</div>","data-quiid":this.getId(),tabindex:-1,events:{click:this.$onClick,mousedown:this.$onMouseDown,mouseup:this.$onMouseUp,mouseenter:this.$onMouseEnter,mouseleave:this.$onMouseLeave}});if(this.getAttribute("icon")&&this.getAttribute("icon")!==""){var Icon=this.$Elm.getElement(".qui-contextitem-icon"),icon=this.getAttribute("icon");if(Utils.isFontAwesomeClass(icon)){Icon.addClass(icon)}else{Icon.setStyle("background-image","url("+icon+")")}}if(this.getAttribute("text")&&this.getAttribute("text")!==""){var Text=this.$Elm.getElement(".qui-contextitem-text");Text.set("html",this.getAttribute("text"))}if(this.getAttribute("dragable")){new DragDrop(this.$Elm,{dropables:".qui-contextitem-dropable",events:{onEnter:function(Element,Droppable){if(!Droppable){return}var quiid=Droppable.get("data-quiid");if(!quiid){return}QUI.Controls.getById(quiid).highlight()},onLeave:function(Element,Droppable){if(!Droppable){return}var quiid=Droppable.get("data-quiid");if(!quiid){return}QUI.Controls.getById(quiid).normalize()},onDrop:function(Element,Droppable,event){if(!Droppable){return}var quiid=Droppable.get("data-quiid");if(!quiid){return}var Bar=QUI.Controls.getById(quiid);Bar.normalize();Bar.appendChild(this)}.bind(this)}})}len=this.$items.length;if(len){this.$Elm.addClass("haschildren");var Menu=this.getContextMenu();for(i=0;i<len;i++){Menu.appendChild(this.$items[i])}}return this.$Elm},insert:function(list){for(var i=0,len=list.length;i<len;i++){if(this.getAttribute("dragable")){list[i].dragable=true}if(list[i].type=="Controls_Contextmenu_Seperator"){this.appendChild(new ContextMenuSeperator(list[i]));continue}this.appendChild(new ContextMenuItem(list[i]))}return this},click:function(){this.$onClick()},appendChild:function(Child){this.$items.push(Child);Child.setParent(this);if(this.$Elm){this.$Elm.addClass("haschildren");Child.inject(this.getContextMenu())}return this},setActive:function(){if(this.$Elm&&this.$Elm.hasClass("qui-contextitem-active")){return this}if(this.$Elm){if(this.$Menu){this.$Elm.getChildren(".qui-contextitem-container").addClass("qui-contextitem-active")}else{this.$Elm.addClass("qui-contextitem-active")}}this.fireEvent("active",[this]);return this},setNormal:function(){if(!this.$Elm){return this}if(this.$Menu){this.$Elm.getChildren(".qui-contextitem-container").removeClass("qui-contextitem-active")}else{this.$Elm.removeClass("qui-contextitem-active")}this.fireEvent("normal",[this]);return this},getChildren:function(name){if(typeof name!=="undefined"){return this.getContextMenu().getChildren(name)}return this.getContextMenu().getChildren()},clear:function(){this.getContextMenu().clear();this.$items=[];return this},getContextMenu:function(){if(this.$Menu){return this.$Menu}console.log(ContextMenu);this.$Menu=new ContextMenu({name:this.getAttribute("name")+"-menu",events:{onShow:function(Menu){var children=Menu.getChildren();for(var i=0,len=children.length;i<len;i++){children[i].setNormal()}}}});this.$Menu.inject(this.$Elm);this.$Menu.hide();this.$Menu.setParent(this.getParent());return this.$Menu},$onSetAttribute:function(key,value){if(!this.$Elm){return}if(key=="text"){this.$Elm.getElement(".qui-contextitem-text").set("html",value);return}if(key=="icon"){var Icon=this.$Elm.getElement(".qui-contextitem-icon");Icon.className="qui-contextitem-icon";Icon.setStyle("background-image",null);if(Utils.isFontAwesomeClass(value)){Icon.addClass(value)}else{this.$Elm.getElement(".qui-contextitem-container").setStyle("background-image","url("+value+")")}return}},$stringEvent:function(event){eval("("+event+"(this));")},$onClick:function(event){this.fireEvent("click",[this,event])},$onMouseEnter:function(event){if(this.$Menu){var size=this.$Elm.getSize(),Parent=this.$Menu.getParent();this.$Menu.setPosition(size.x,0);this.$Menu.show();if(Parent){var MenuElm=this.$Menu.getElm(),elm_pos=MenuElm.getPosition(),elm_size=MenuElm.getSize(),body_size=document.body.getSize();if(elm_pos.x+size.x>body_size.x){this.$Menu.setPosition(0-elm_size.x,0)}}this.$Elm.getChildren(".qui-contextitem-container").addClass("qui-contextitem-active")}this.setActive()},$onMouseLeave:function(event){if(this.$Menu){this.$Menu.hide()}this.$Elm.getChildren(".qui-contextitem-container").removeClass("qui-contextitem-active");this.setNormal()},$onMouseUp:function(event){this.fireEvent("mouseUp",[this,event]);event.stop()},$onMouseDown:function(event){this.fireEvent("mouseDown",[this,event]);event.stop()}})});
//# sourceMappingURL=/var/www/git/quiqqer/qui/build/qui/controls/contextmenu/Item.map.js